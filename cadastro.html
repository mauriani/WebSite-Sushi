<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>Sushi you again?</title>

    <link rel="stylesheet" href="css/styles.css" />

    <script language="javascript" type="text/javascript">
      function cpf(cpf) {
        cpf = cpf.replace(/\D/g, "");
        if (cpf.toString().length != 11 || /^(\d)\1{10}$/.test(cpf))
          return false;
        var result = true;
        [9, 10].forEach(function (j) {
          var soma = 0,
            r;
          cpf
            .split(/(?=)/)
            .splice(0, j)
            .forEach(function (e, i) {
              soma += parseInt(e) * (j + 2 - (i + 1));
            });
          r = soma % 11;
          r = r < 2 ? 0 : 11 - r;
          if (r != cpf.substring(j, j + 1)) result = false;
        });
        return result;
      }

      function realizarCadastro() {
        var nome = document.getElementById("nome");
        var email = document.getElementById("email");
        var cpf = document.getElementById("cpf");
        var endereco = document.getElementById("endereco");
        var phone = document.getElementById("phone");
        var cep = document.getElementById("cep");
        var password = document.getElementById("password");

        if (nome.value == "") {
          alert("Para continuar informe o seu nome");
          nome.focus();
          return;
        }
        if (email.value == "") {
          alert("Para continuar informe o seu E-mail");
          email.focus();
          return;
        } else {
          var re = /\S+@\S+\.\S+/;
          var isValidEmail = re.test(email.value);
          if (isValidEmail == false) {
            alert("E-mail inválido");
            return;
          }
        }

        if (cpf.value == "") {
          alert("Para continuar informe o seu CPF");
          cpf.focus();
          return;
        } else {
          var isValidCpf = this.cpf(cpf.value);

          if (isValidCpf == false) {
            alert("O cpf é inválido, informe um cpf válido");
            return;
          }
        }

        if (endereco.value == "") {
          alert("Para continuar informe o seu endereço");
          endereco.focus();
          return;
        }

        if (phone.value == "") {
          alert("Para continuar informe o seu telefone");
          phone.focus();
          return;
        }

        if (cep.value == "") {
          alert("Para continuar informe o seu cep");
          cep.focus();
          return;
        }

        if (password.value == "") {
          alert("Para continuar informe o campo de senha");
          password.focus();
          return;
        }

        if (
          nome.value != "" &&
          email.value != "" &&
          cpf.value != "" &&
          phone.value != "" &&
          endereco.value != "" &&
          cep.value != "" &&
          password.value != ""
        ) {
          alert("Dados cadastrados com sucesso");
        }
      }

      /*MASCARA*/

      function mascara(i) {
        var v = i.value;

        if (isNaN(v[v.length - 1])) {
          // impede entrar outro caractere que não seja número
          i.value = v.substring(0, v.length - 1);
          return;
        }

        i.setAttribute("maxlength", "14");
        if (v.length == 3 || v.length == 7) i.value += ".";
        if (v.length == 11) i.value += "-";
      }

      /* CAMPOS DE ENDEREÇO */

      function limpa_formulário_cep() {
        //Limpa valores do formulário de cep.
        document.getElementById("endereco").value = "";
        document.getElementById("bairro").value = "";
        document.getElementById("cidade").value = "";
        document.getElementById("uf").value = "";
      }

      /*ADICIONA VALUE AOS MEUS CAMPOS*/
      function meu_callback(conteudo) {
        if (!("erro" in conteudo)) {
          //Atualiza os campos com os valores.
          document.getElementById("endereco").value = conteudo.logradouro;
          document.getElementById("bairro").value = conteudo.bairro;
          document.getElementById("cidade").value = conteudo.localidade;
          document.getElementById("uf").value = conteudo.uf;
        } //end if.
        else {
          //CEP não Encontrado.
          limpa_formulário_cep();
          alert("CEP não encontrado.");
        }
      }

      function pesquisacep(valor) {
        //Nova variável "cep" somente com dígitos.

        console.log(valor, "valor");
        var cep = valor.replace(/\D/g, "");

        //Verifica se campo cep possui valor informado.
        if (cep != "") {
          //Expressão regular para validar o CEP.
          var validacep = /^[0-9]{8}$/;

          //Valida o formato do CEP.
          if (validacep.test(cep)) {
            //Preenche os campos com "..." enquanto consulta webservice.
            document.getElementById("endereco").value = "...";
            document.getElementById("bairro").value = "...";
            document.getElementById("cidade").value = "...";
            document.getElementById("uf").value = "...";

            //Cria um elemento javascript.
            var script = document.createElement("script");

            //Sincroniza com o callback.
            script.src =
              "https://viacep.com.br/ws/" +
              cep +
              "/json/?callback=meu_callback";

            //Insere script no documento e carrega o conteúdo.
            document.body.appendChild(script);
          } //end if.
          else {
            //cep é inválido.
            limpa_formulário_cep();
            alert("Formato de CEP inválido.");
          }
        } else {
          //cep sem valor, limpa formulário.
          limpa_formulário_cep();
        }
      }
    </script>
  </head>

  <body>
    <header>
      <nav>
        <a class="logo" src="" alt="logo da empresa">Sushi you again</a>

        <ul class="nav-list">
          <li>
            <a href="index.html" class="menu-link">Inicio</a>
          </li>

          <li>
            <a href="menu.html" class="menu-link">Menu</a>
          </li>

          <li>
            <a href="sobre.html" class="menu-link">Sobre</a>
          </li>

          <li>
            <a href="contato.html" class="menu-link">Contato</a>
          </li>

          <li>
            <a href="cadastro.html" class="menu-link">
              <i class="fa fa-user"></i>
            </a>
          </li>
        </ul>
      </nav>
    </header>

    <main>
      <section class="section-contact">
        <h1>Cadastre-se</h1>

        <form name="form" id="form">
          <label for="nome">Nome completo:</label>
          <input type="text" id="nome" name="nome" required />

          <label for="email">E-mail:</label>
          <input
            type="email"
            id="email"
            name="email"
            placeholder="Ex: johndoe@gmail.com"
            required
          />

          <label for="cpf">CPF:</label>
          <input
            type="text"
            name="cpf"
            id="cpf"
            oninput="mascara(this)"
            required
          />

          <div class="row">
            <div class="column">
              <label for="phone">Telefone:</label>
              <input
                type="tel"
                id="phone"
                name="phone"
                required
                placeholder="Ex: (00) 0000-0000"
              />
            </div>

            <div class="column">
              <label for="cep">CEP:</label>
              <input
                type="text"
                name="CEP"
                id="cep"
                size="10"
                maxlength="9"
                onblur="pesquisacep(this.value);"
                required
              />
            </div>
          </div>

          <label for="endereco">Endereço:</label>
          <input type="text" id="endereco" name="endereco" />

          <label for="bairro">Bairro:</label>
          <input type="bairro" id="bairro" name="bairro" />

          <label for="cidade">Cidade:</label>
          <input type="cidade" id="cidade" name="cidade" />

          <label for="uf">UF:</label>
          <input type="uf" id="uf" name="uf" />

          <label for="pass">Senha (Min 8 caracteres):</label>
          <input
            type="password"
            id="password"
            name="password"
            minlength="8"
            required
          />

          <div class="button">
            <button type="submit" onClick="realizarCadastro()">Enviar</button>
          </div>
        </form>
      </section>
    </main>
  </body>
</html>
